<source>
  @type forward
  port 24225
</source>

<filter **>
  @type grep
  <regexp>
    key log
    pattern ERROR
  </regexp>
</filter>

<filter **>
  @type parser
  key_name log
  format json
  reserve_data true
  replace_invalid_sequence true
</filter>

<filter **>
  @type record_transformer
  enable_ruby true
  remove_keys log
  <record>
    container_id ${record["container_id"]}
  </record>
</filter>

<match **>
  @type copy

  <store>
    @type stdout
  </store>

  <store>
    @type http
    endpoint http://host.docker.internal:8090/api/v1/logs
    http_method post

    headers {"Content-Type":"application/json"}

    serializer json

    <format>
      @type json
    </format>

    <buffer>
      flush_interval 5s
    </buffer>
  </store>
</match>

